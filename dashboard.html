<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>Dashboard - Smart GreenHeat</title>

  <link rel="stylesheet" href="css/dashboard.css" />
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Utility: hide/show used by the JS (Plan A) -->
  <style>
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <!-- Loading Spinner -->
  <div id="loading-overlay" class="loading-overlay" aria-live="polite">
    <div class="spinner" aria-hidden="true"></div>
    <p>Memuat dashboard...</p>
  </div>

  <div class="container">
    <!-- Header -->
    <header class="main-header">
      <div class="header-left">
        <div class="logo-container">
          <img src="assets/images/logo.png" alt="Smart GreenHeat Logo" class="logo" />
          <h1>Smart GreenHeat Dashboard</h1>
        </div>
      </div>
      <div class="header-right">
        <div class="user-info">
          <span id="user-status">ðŸ‘¤ Guest</span>
          <!-- Start hidden; JS will show after login -->
          <button id="auth-btn" class="auth-button hidden" type="button"
                  onclick="toggleAuth()" aria-label="Logout" title="Logout">
            <i class="fas fa-right-from-bracket" aria-hidden="true"></i>
            Logout
          </button>
        </div>
      </div>
    </header>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="card-header">
          <i class="fas fa-thermometer-half icon-temperature" aria-hidden="true"></i>
          <h3>Suhu</h3>
        </div>
        <div class="card-content">
          <p class="value" id="temp-value">--</p>
          <p class="unit">Â°C</p>
        </div>
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="temp-progress"></div>
          </div>
          <div class="progress-labels">
            <span>0Â°C</span>
            <span>100Â°C</span>
          </div>
        </div>
      </div>

      <div class="stat-card">
        <div class="card-header">
          <i class="fas fa-tint icon-humidity" aria-hidden="true"></i>
          <h3>Kelembapan</h3>
        </div>
        <div class="card-content">
          <p class="value" id="humidity-value">--</p>
          <p class="unit">%</p>
        </div>
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="humidity-progress"></div>
          </div>
          <div class="progress-labels">
            <span>0%</span>
            <span>100%</span>
          </div>
        </div>
      </div>

      <div class="stat-card">
        <div class="card-header">
          <i class="fas fa-power-off icon-status" aria-hidden="true"></i>
          <h3>Status</h3>
        </div>
        <div class="card-content">
          <p class="value" id="status-value">--</p>
          <div class="status-source">
            <span class="source-label">Kontrol:</span>
            <span id="source-value" class="source-text">--</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Grafik Sensor -->
    <div class="section" id="chart-section">
      <div class="section-header">
        <h2><i class="fas fa-chart-line" aria-hidden="true"></i> Grafik Sensor</h2>
        <div class="range-tabs" role="tablist" aria-label="Rentang waktu grafik">
          <button class="range-btn active" data-min="15">15m</button>
          <button class="range-btn" data-min="60">1h</button>
          <button class="range-btn" data-min="360">6h</button>
          <button class="range-btn" data-min="1440">24h</button>
          <button class="range-btn" data-min="all">All</button>
        </div>
      </div>
      <div class="chart-wrapper">
        <canvas id="sensorChart" aria-label="Grafik suhu dan kelembapan" role="img"></canvas>
      </div>
    </div>

    <!-- Control Panel -->
    <div class="section" id="control-section">
      <div class="section-header">
        <h2><i class="fas fa-bolt" aria-hidden="true"></i> Kontrol Sistem</h2>
        <div class="control-right">
          <button class="export-btn" type="button" onclick="exportData()">
            <i class="fas fa-download" aria-hidden="true"></i> Export
          </button>
          <!-- fixed: call wifiReconfig() (matches JS) -->
          <button class="wifi-btn" type="button" onclick="wifiReconfig()">
            <i class="fas fa-wifi" aria-hidden="true"></i> Ganti Wi-Fi
          </button>
        </div>
      </div>

      <div class="control-buttons">
        <button class="control-btn btn-success" type="button" onclick="sendCommand('start')">
          <i class="fas fa-play" aria-hidden="true"></i> START
        </button>
        <button class="control-btn btn-danger" type="button" onclick="sendCommand('stop')">
          <i class="fas fa-stop" aria-hidden="true"></i> STOP
        </button>
        <button class="control-btn btn-info" type="button" onclick="refreshData()">
          <i class="fas fa-sync-alt" aria-hidden="true"></i> REFRESH
        </button>
      </div>
    </div>

    <!-- Modal Logout (managed with .hidden) -->
    <div id="logout-modal" class="modal hidden" aria-hidden="true">
      <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="logout-title">
        <div class="modal-header">
          <h2 id="logout-title">
            <i class="fas fa-right-from-bracket" aria-hidden="true"></i> Konfirmasi Logout
          </h2>
          <span class="close" role="button" tabindex="0" onclick="closeModal()" aria-label="Tutup">&times;</span>
        </div>
        <div class="modal-body">
          <p>Apakah Anda yakin ingin keluar dari dashboard?</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" onclick="closeModal()">
            <i class="fas fa-times btn-icon" aria-hidden="true"></i> Batal
          </button>
          <!-- fixed: give the button an id for JS to disable -->
          <button id="logout-btn" class="btn btn-danger" type="button" onclick="logout()">
            <i class="fas fa-power-off btn-icon" aria-hidden="true"></i> Logout
          </button>
        </div>
      </div>
    </div>

    <!-- Modal: Mesin Offline (JS uses style.display; DO NOT add .hidden here) -->
    <div id="device-offline-modal" class="modal" aria-hidden="true" style="display:none">
      <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="offline-title">
        <div class="modal-header">
          <h2 id="offline-title"><i class="fas fa-wifi-slash" aria-hidden="true"></i> Mesin Offline</h2>
          <span class="close" role="button" tabindex="0" onclick="showOfflineModal(false)" aria-label="Tutup">&times;</span>
        </div>
        <div class="modal-body">
          <p><strong>Hubungkan koneksi internet pada Mesin</strong> agar kontrol dapat digunakan.</p>
          <ul style="margin-left:1rem">
            <li>Periksa Wi-Fi/internet ESP32</li>
            <li>Pastikan daya menyala</li>
            <li>Tunggu beberapa detik hingga tersambung kembali</li>
          </ul>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" onclick="showOfflineModal(false)">
            <i class="fas fa-check btn-icon" aria-hidden="true"></i> Oke
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Bottom Navigation -->
  <nav class="mobile-nav" aria-label="Bottom navigation">
    <a href="#" class="nav-item active">
      <i class="fas fa-home" aria-hidden="true"></i>
      <span>Dashboard</span>
    </a>
    <a href="#" class="nav-item">
      <i class="fas fa-chart-line" aria-hidden="true"></i>
      <span>Grafik</span>
    </a>
    <a href="#" class="nav-item">
      <i class="fas fa-gamepad" aria-hidden="true"></i>
      <span>Kontrol</span>
    </a>
    <a href="#" class="nav-item">
      <i class="fas fa-cog" aria-hidden="true"></i>
      <span>Pengaturan</span>
    </a>
  </nav>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Inisialisasi Firebase (punyamu) -->
  <script src="firebase-config.js"></script>

  <!-- Logic dashboard (Plan A / compat) -->
  <script src="js/dashboard.js"></script>
</body>
          </html>
